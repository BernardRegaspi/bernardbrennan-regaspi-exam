<!DOCTYPE html>
<html>
  <head>
    <title>YouTube Channel Viewer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;400;500;600;700;800;900&family=Quicksand:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <style>
      * {
        font-family: Quicksand;
      }
      .loading-container {
        display: flex;
        justify-content: center;
        align-items: center;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(255, 255, 255, 0.7);
        z-index: 9999;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
  </head>
  <body>
    <div id="app">
      <div v-if="isLoading" class="loading-container">
        <h5>Loading...</h5>
      </div>
      <div v-else>
        <div class="mb-5 py-4" style="background-color: #af1b3f">
          <div class="container d-flex align-items-center text-white">
            <div class="p-2">
              <img
                :src="channelProfilePicture"
                alt="Channel Profile Picture"
                width="240"
                class="rounded-circle"
              />
            </div>
            <div class="p-2">
              <h1>{{ channelName }}</h1>
              <p>
                <span class="fw-bold">Channel Description:</span> <br />{{
                channelDescription }}
              </p>
            </div>
          </div>
        </div>

        <div class="container">
          <div class="row">
            <div
              class="col-4 mb-4"
              v-for="(video) in paginatedVideos"
              :key="video.videoTitle"
            >
              <div class="card">
                <iframe
                  :src="'https://www.youtube.com/embed/' + video.videoId"
                  height="210"
                ></iframe>
              </div>
            </div>
          </div>
          <nav aria-label="Page navigation example">
            <ul class="pagination justify-content-center">
              <li class="page-item" :class="{ disabled: currentPage === 1 }">
                <a class="page-link" @click="prevPage" style="cursor: pointer">
                  Previous
                </a>
              </li>
              <li class="page-item" v-for="page in totalPages" :key="page">
                <a
                  class="page-link"
                  @click="changePage(page)"
                  style="cursor: pointer"
                  :class="{ 'bg-primary text-white': page === currentPage }"
                >
                  {{ page }}
                </a>
              </li>
              <li
                class="page-item"
                :class="{ disabled: currentPage === totalPages }"
              >
                <a class="page-link" @click="nextPage" style="cursor: pointer">
                  Next
                </a>
              </li>
            </ul>
          </nav>
        </div>
        <footer class="py-4" style="background-color: #212738">
          <div class="container">
            <h5 class="text-white text-center">
              <span class="fw-bold">EXAM BY:</span> Bernard Brennan Regaspi
            </h5>
            <p class="text-center fs-3 text-white fw-bold">Codalify</p>
          </div>
        </footer>
      </div>
    </div>

    <script>
      // Define a global callback function for JSONP data
      function handleData(data) {
        app.handleData(data);
      }

      const app = new Vue({
        el: "#app",
        data: {
          channelName: "",
          channelDescription: "",
          channelProfile: "",
          channelProfilePicture: "",
          videos: [],
          currentPage: 1,
          perPage: 20,
          isLoading: true,
        },
        computed: {
          paginatedVideos() {
            const startIndex = (this.currentPage - 1) * this.perPage;
            const endIndex = startIndex + this.perPage;
            return this.videos.slice(startIndex, endIndex);
          },
          totalPages() {
            return Math.ceil(this.videos.length / this.perPage);
          },
        },
        methods: {
          fetchData() {
            const script = document.createElement("script");
            script.src =
              "http://localhost/youtube/youtube_channel_json.php?callback=handleData";
            script.onload = () => {
              this.isLoading = false;
            };
            document.body.appendChild(script);
          },
          handleData(data) {
            this.channelName = data.channelName;
            this.channelDescription = data.channelDescription;
            this.channelProfile = data.channelProfile;
            this.channelProfilePicture = data.channelProfilePicture;
            this.videos = data.videos;
          },
          changePage(page) {
            this.currentPage = page;
          },
          prevPage() {
            if (this.currentPage > 1) {
              this.currentPage--;
            }
          },
          nextPage() {
            if (this.currentPage < this.totalPages) {
              this.currentPage++;
            }
          },
        },
        mounted() {
          this.fetchData();
        },
      });
    </script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
